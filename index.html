<!-- FILE: index.html -->
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Snake — Single File Web App</title>
  <style>
    :root{--bg:#0b1220;--panel:#0f1724;--accent:#10b981;--muted:#94a3b8}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#071029,#081224);color:#e6eef8}
    .container{width:min(720px,96vw);display:grid;grid-template-columns:1fr 240px;gap:18px;padding:18px}
    .card{background:rgba(255,255,255,0.03);border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(3,7,18,0.6)}
    .game{display:flex;flex-direction:column;align-items:center;gap:10px}
    canvas{background:linear-gradient(180deg,#081827,#042035);border-radius:8px;display:block}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    button{background:transparent;border:1px solid rgba(255,255,255,0.08);padding:8px 10px;border-radius:8px;color:inherit;cursor:pointer}
    button.primary{background:var(--accent);color:#042018;border:none}
    .panel{padding:12px;display:flex;flex-direction:column;gap:8px}
    .small{font-size:13px;color:var(--muted)}
    .score{font-weight:700;font-size:22px}
    .mobile-pad{display:none;gap:6px;justify-content:center}
    .pad-row{display:flex;gap:6px}
    .pad-btn{width:56px;height:56px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);font-weight:700}
    @media (max-width:900px){.container{grid-template-columns:1fr;padding:12px}.panel{order:2}.mobile-pad{display:flex}}
  </style>
</head>
<body>
  <div class="container">
    <div class="card game" id="gameCard">
      <canvas id="gameCanvas" width="480" height="480" style="width:100%;height:auto"></canvas>
      <div class="controls">
        <div style="display:flex;gap:8px;align-items:center">
          <button id="startBtn" class="primary">Start / Neustart</button>
          <button id="pauseBtn">Pause</button>
          <label class="small" style="margin-left:8px">Geschwindigkeit:
            <input id="speedRange" type="range" min="4" max="14" value="8" style="vertical-align:middle;margin-left:6px">
          </label>
        </div>
        <div class="small" id="hint">Pfeiltasten oder W/A/S/D verwenden. Auf Mobilgeräten die Steuerkreuze nutzen.</div>
      </div>
      <div class="mobile-pad" aria-hidden="false">
        <div class="pad-row">
          <div></div>
          <div class="pad-btn" data-dir="up">▲</div>
          <div></div>
        </div>
        <div class="pad-row">
          <div class="pad-btn" data-dir="left">◀</div>
          <div class="pad-btn" data-dir="down">▼</div>
          <div class="pad-btn" data-dir="right">▶</div>
        </div>
      </div>
    </div>

    <div class="card panel">
      <div>
        <div class="small">Snake — Einfache Web-App</div>
        <div class="score" id="score">Score: 0</div>
      </div>
      <div class="small">Bestenliste (local):</div>
      <ol id="highscores" class="small" style="margin:6px 0;padding-left:18px"></ol>
      <div style="display:flex;gap:8px;flex-direction:column;margin-top:8px">
        <button id="exportBtn">Als ZIP herunterladen</button>
        <button id="githubGuide">Zum GitHub Repo hochladen</button>
      </div>
      <hr style="opacity:0.06;margin:10px 0">
      <div class="small">Tipps:
        <ul style="margin:6px 0 0 18px">
          <li>Die App ist eine einzelne HTML-Datei — direkt in Browser öffnen.</li>
          <li>Für GitHub: neue Repo erstellen, Datei hochladen oder git push verwenden.</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
  // --- Game configuration ---
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const gridSize = 20; // number of cells per row/col
  const cellSize = Math.floor(canvas.width / gridSize); // pixel size

  let snake = [{x:10,y:10}];
  let dir = {x:0,y:0};
  let nextDir = {x:0,y:0};
  let apple = null;
  let score = 0;
  let running = false;
  let loopId = null;
  let speed = 8; // frames per second

  // DOM
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const scoreEl = document.getElementById('score');
  const highscoresEl = document.getElementById('highscores');
  const speedRange = document.getElementById('speedRange');
  const exportBtn = document.getElementById('exportBtn');
  const githubGuide = document.getElementById('githubGuide');

  // init
  loadHighscores();
  draw();

  function reset(){
    snake = [{x:Math.floor(gridSize/2),y:Math.floor(gridSize/2)}];
    dir = {x:0,y:0};
    nextDir = {x:0,y:0};
    placeApple();
    score = 0;
    updateScore();
  }

  function placeApple(){
    while(true){
      const p = {x:rand(gridSize), y:rand(gridSize)};
      if(!snake.some(s=>s.x===p.x && s.y===p.y)){ apple = p; break; }
    }
  }

  function rand(n){return Math.floor(Math.random()*n)}

  function gameTick(){
    // apply nextDir but prevent immediate reverse
    if((nextDir.x !== -dir.x || nextDir.y !== -dir.y) ) dir = {...nextDir};
    if(dir.x===0 && dir.y===0) return; // not moving

    const head = {x:snake[0].x + dir.x, y:snake[0].y + dir.y};

    // wrap-around
    head.x = (head.x + gridSize) % gridSize;
    head.y = (head.y + gridSize) % gridSize;

    // collision with self
    if(snake.some(s=>s.x===head.x && s.y===head.y)){
      gameOver();
      return;
    }

    snake.unshift(head);

    // ate apple
    if(head.x===apple.x && head.y===apple.y){
      score++;
      updateScore();
      placeApple();
    } else {
      snake.pop();
    }

    draw();
  }

  function draw(){
    // clear
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // background grid
    ctx.fillStyle = '#081827';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // apple
    if(apple){
      drawCell(apple.x, apple.y, '#ff4d6d');
      // small shine
      ctx.fillStyle = 'rgba(255,255,255,0.08)';
      ctx.fillRect(apple.x*cellSize+cellSize*0.18, apple.y*cellSize+cellSize*0.12, cellSize*0.44, cellSize*0.26);
    }

    // snake
    snake.forEach((s,i)=>{
      const t = i===0 ? '#10b981' : `rgba(16,185,129,${Math.max(0.3,1 - i/Math.max(6,snake.length))})`;
      drawCell(s.x,s.y,t);
    });
  }

  function drawCell(x,y,color){
    ctx.fillStyle = color;
    ctx.fillRect(x*cellSize+1, y*cellSize+1, cellSize-2, cellSize-2);
  }

  function start(){
    reset();
    running = true;
    startLoop();
  }

  function pause(){
    running = false;
    stopLoop();
  }

  function startLoop(){
    stopLoop();
    const interval = 1000 / speed;
    loopId = setInterval(gameTick, interval);
  }

  function stopLoop(){ if(loopId){clearInterval(loopId); loopId = null;} }

  function gameOver(){
    pause();
    saveHighscore(score);
    alert('Game Over — Dein Score: ' + score);
  }

  function updateScore(){ scoreEl.textContent = 'Score: ' + score; }

  // input
  window.addEventListener('keydown', (e)=>{
    const k = e.key.toLowerCase();
    if(k==='arrowup' || k==='w') nextDir = {x:0,y:-1};
    if(k==='arrowdown' || k==='s') nextDir = {x:0,y:1};
    if(k==='arrowleft' || k==='a') nextDir = {x:-1,y:0};
    if(k==='arrowright' || k==='d') nextDir = {x:1,y:0};
    if(k===' '){ if(running) pause(); else start(); }
  });

  // mobile pad
  document.querySelectorAll('.pad-btn').forEach(btn=>{
    btn.addEventListener('touchstart', (e)=>{ e.preventDefault(); const d=btn.dataset.dir; setFromDir(d); });
    btn.addEventListener('mousedown', ()=>{ const d=btn.dataset.dir; setFromDir(d); });
  });
  function setFromDir(d){ if(d==='up') nextDir={x:0,y:-1}; if(d==='down') nextDir={x:0,y:1}; if(d==='left') nextDir={x:-1,y:0}; if(d==='right') nextDir={x:1,y:0}; }

  // buttons
  startBtn.addEventListener('click', ()=>{ start(); startBtn.blur(); });
  pauseBtn.addEventListener('click', ()=>{ if(running) pause(); else start(); pauseBtn.blur(); });
  speedRange.addEventListener('input', ()=>{ speed = Number(speedRange.value); if(running) startLoop(); });

  // highscores (localStorage)
  function loadHighscores(){
    const list = JSON.parse(localStorage.getItem('snake_highscores')||'[]');
    renderHighscores(list);
  }
  function saveHighscore(s){
    const list = JSON.parse(localStorage.getItem('snake_highscores')||'[]');
    list.push({score:s,date:new Date().toISOString()});
    list.sort((a,b)=>b.score-a.score);
    while(list.length>10) list.pop();
    localStorage.setItem('snake_highscores', JSON.stringify(list));
    renderHighscores(list);
  }
  function renderHighscores(list){
    highscoresEl.innerHTML = list.map(i=>`<li>${i.score} — ${new Date(i.date).toLocaleString('de-DE')}</li>`).join('') || '<li class="small">Noch keine Einträge</li>';
  }

  // export single-file as blob (simple ZIP-ish by downloading the HTML)
  exportBtn.addEventListener('click', ()=>{
    const blob = new Blob([document.documentElement.outerHTML], {type:'text/html'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'snake-single-file.html';
    document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);
  });

  githubGuide.addEventListener('click', ()=>{
    alert('Kurzanleitung:\n1) Neues GitHub-Repository erstellen (oder vorhandenes öffnen)\n2) Datei "index.html" hochladen oder per git push hinzufügen\n3) Im Repo auf "Settings" → "Pages" gehen und Branch (z. B. main) als Source auswählen, um die App als GitHub Pages zu hosten.');
  });

  // adapt canvas size on high-DPI screens
  function resizeCanvas(){
    const ratio = window.devicePixelRatio || 1;
    const size = Math.min(720, Math.floor(window.innerWidth*0.9));
    canvas.style.height = '';
    canvas.width = 480; canvas.height = 480; // fixed resolution for predictable grid
  }
  window.addEventListener('resize', ()=>{ resizeCanvas(); draw(); });

  // start with a placed apple
  placeApple();

  </script>
</body>
</html>
